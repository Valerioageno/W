W={reset:e=>{W.last=0,W.dt=0,W.o=0,W.p={},W.n={},W.textures={},W.vertices={},W.texCoords={},W.indices={},W.perspective=new DOMMatrix([1/Math.tan(.5)/(e.width/e.height),0,0,0,0,1/Math.tan(.5),0,0,0,0,901/-899,-1,0,0,1800/-899,0]),W.gl=e.getContext("webgl2"),W.gl.blendFunc(770,771),W.gl.activeTexture(33984),W.P=W.gl.createProgram(),W.gl.shaderSource(t=W.gl.createShader(35633),"#version 300 es\n in vec4 position,color,tex;uniform mat4 pv,eye,m;uniform vec3 billboard;out vec4 v_position,v_color,v_texCoord;void main(){gl_Position=pv*(v_position=(billboard.z>0.)?(m[3]+eye*(position*-vec4(billboard,0))):(m*position));v_color=color;v_texCoord=tex;}"),W.gl.compileShader(t),W.gl.attachShader(W.P,t),W.gl.shaderSource(t=W.gl.createShader(35632),"#version 300 es\n precision highp float;in vec4 v_position,v_color,v_texCoord;uniform vec3 light;uniform sampler2D sampler;out vec4 c;void main(){vec4 col=(v_color.a==0.? texture(sampler,v_texCoord.xy): v_color);c=vec4(col.rgb*(max(dot(normalize(light),normalize(cross(dFdx(v_position.xyz),dFdy(v_position.xyz)))),0.)+.2),col.a);}"),W.gl.compileShader(t),W.gl.attachShader(W.P,t),W.gl.linkProgram(W.P),W.gl.useProgram(W.P),W.gl.clearColor(1,1,1,1),W.gl.enable(2929),W.gl.bindBuffer(34962,W.vertices.c=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array([.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,.5,.5,-.5,-.5,.5,.5,.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,.5,.5,.5,-.5,-.5,.5,-.5,.5,.5,.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,.5,.5,-.5,.5,.5,-.5,-.5,-.5,-.5,.5,.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,-.5,-.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,.5,-.5]),35044),W.gl.bindBuffer(34962,W.texCoords.c=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array([1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]),35044),W.gl.bindBuffer(34962,W.vertices.p=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array([-.5,-.5,.5,.5,-.5,.5,0,.5,0,.5,-.5,.5,.5,-.5,-.5,0,.5,0,.5,-.5,-.5,-.5,-.5,-.5,0,.5,0,-.5,-.5,-.5,-.5,-.5,.5,0,.5,0,-.5,-.5,.5,-.5,-.5,-.5,.5,-.5,.5,-.5,-.5,-.5,.5,-.5,-.5,.5,-.5,.5]),35044),W.gl.bindBuffer(34962,W.texCoords.p=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array([0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,1,0,0,0,0,1,1,0,0,1,1,1]),35044),W.gl.bindBuffer(34962,W.vertices.q=W.vertices.b=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array([.5,.5,0,-.5,.5,0,-.5,-.5,0,.5,.5,0,-.5,-.5,0,.5,-.5,0]),35044),W.gl.bindBuffer(34962,W.texCoords.q=W.texCoords.b=W.gl.createBuffer()),W.gl.bufferData(34962,new Float32Array([1,0,0,0,0,1,1,0,0,1,1,1]),35044),W.light({z:1}),W.camera({}),W.d()},l:e=>W.n[W.N]?.t?W.p[W.N][e]+(W.n[W.N][e]-W.p[W.N][e])*(W.n[W.N].f/W.n[W.N].t):W.n[W.N][e],t:()=>W.n[W.N]?(new DOMMatrix).translateSelf(W.l("x"),W.l("y"),W.l("z")).rotateSelf(W.l("rx"),W.l("ry"),W.l("rz")).scaleSelf(W.l("w"),W.l("h"),W.l("d")):new DOMMatrix,i:(e,r)=>{e.n||="o"+W.o++,e.b&&e.b.id&&e.b.width&&!W.textures[e.b.id]&&(r=W.gl.createTexture(),W.gl.pixelStorei(37441,!0),W.gl.bindTexture(3553,r),W.gl.pixelStorei(37440,1),W.gl.texImage2D(3553,0,6408,6408,5121,e.b),W.gl.generateMipmap(3553),W.textures[e.b.id]=r),e={...W.p[e.n]=W.n[e.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"777"},...e},e.t||=0,e.f=0,W.n[e.n]=e},group:e=>{e.T="g",W.i(e)},plane:e=>{e.T="q",W.i(e)},billboard:e=>{e.T="b",W.i(e)},cube:e=>{e.T="c",W.i(e)},pyramid:e=>{e.T="p",W.i(e)},move:e=>W.i(e),camera:e=>{e.n="C",W.i(e)},light:e=>{e.n="L",W.i(e)},d:(e,r,t,l,o,n,i,a=[])=>{for(o in W.dt=(e-W.last)/1e3,W.last=e,requestAnimationFrame(W.d),W.gl.clear(16640),t=new DOMMatrix,W.N="C",t=W.t(t),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.P,"eye"),!1,t.toFloat32Array()),t.invertSelf(),t.preMultiplySelf(W.perspective),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.P,"pv"),!1,t.toFloat32Array()),W.n)W.n[o].b.id||W.n[o].b[3]?a.push(W.n[o]):W.r(W.n[o]);for(o in a.sort(((e,r)=>e.m&&r.m&&W.dist(r.m,W.n.C.m)-W.dist(e.m,W.n.C.m))),W.gl.enable(3042),a)W.r(a[o]);W.gl.disable(3042)},r:(e,r=[0,0,0],t,l,o)=>{e.b.id&&(W.gl.bindTexture(3553,W.textures[e.b.id]),W.gl.uniform1i(W.gl.getUniformLocation(W.P,"sampler"),0)),e.f<e.t&&(e.f+=W.dt),e.f>e.t&&(e.f=e.t),e.center=r,W.N=e.n,W.n[e.n].m=W.t(),W.n[e.g]&&W.n[e.n].m.preMultiplySelf(W.n[e.g].m),W.gl.uniformMatrix4fv(W.gl.getUniformLocation(W.P,"m"),!1,W.n[e.n].m.toFloat32Array()),["C","L"].includes(e.n)||"g"==e.T||(e.center=r,W.gl.bindBuffer(34962,W.vertices[e.T]),W.gl.vertexAttribPointer(o=W.gl.getAttribLocation(W.P,"position"),3,5126,!1,0,0),W.gl.enableVertexAttribArray(o),W.texCoords[e.T]&&(W.gl.bindBuffer(34962,W.texCoords[e.T]),W.gl.vertexAttribPointer(o=W.gl.getAttribLocation(W.P,"tex"),2,5126,!1,0,0),W.gl.enableVertexAttribArray(o)),W.gl.vertexAttrib4fv(W.gl.getAttribLocation(W.P,"color"),e.b.id?[0,0,0,0]:[...[...e.b].map((e=>("0x"+e)/16)),e.b.id?0:1]),W.N="L",W.gl.uniform3f(W.gl.getUniformLocation(W.P,"light"),W.l("x"),W.l("y"),W.l("z")),W.gl.uniform3f(W.gl.getUniformLocation(W.P,"billboard"),e.w,e.h,"b"==e.T),W.gl.drawArrays(4,0,W.gl.getBufferParameter(34962,34660)/8))},dist:(e,r)=>(r.m41-e.m41)**2+(r.m42-e.m42)**2+(r.m43-e.m43)**2}