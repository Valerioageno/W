W={last:0,dt:0,o:0,p:{},n:{},textures:{},s:e=>{gl=a.getContext("webgl2"),gl.blendFunc(gl.SRC_ALPHA,gl.ONE_MINUS_SRC_ALPHA),W.P=gl.createProgram(),gl.shaderSource(e=gl.createShader(35633),"#version 300 es\n in vec4 position;in vec4 color;in vec2 tex;uniform mat4 pv;uniform mat4 eye;uniform mat4 m;uniform vec3 billboard;out vec4 v_color;out vec3 v_position;out vec2 v_texCoord;void main(){gl_Position=pv*((billboard.z>0.)?(m[3]+eye*(position*-vec4(billboard,0))):(m*position));v_position=vec3(m*position);v_color=color;v_texCoord=tex;}"),gl.compileShader(e),gl.attachShader(W.P,e),gl.shaderSource(e=gl.createShader(35632),"#version 300 es\n precision highp float;in vec3 v_position;in vec4 v_color;in vec2 v_texCoord;uniform vec3 light;uniform sampler2D sampler;out vec4 c;void main(){vec4 col=(v_color.a==0.? texture(sampler,v_texCoord): v_color);c=vec4(col.rgb*(max(dot(normalize(light),normalize(cross(dFdx(v_position),dFdy(v_position)))),0.)+.2),col.a);} "),gl.compileShader(e),gl.attachShader(W.P,e),gl.linkProgram(W.P),gl.useProgram(W.P),gl.clearColor(1,1,1,1),gl.enable(2929)},l:e=>W.n[W.N].t?W.p[W.N][e]+(W.n[W.N][e]-W.p[W.N][e])*(W.n[W.N].f/W.n[W.N].t):W.n[W.N][e],t:e=>(new DOMMatrix).translateSelf(W.l("x"),W.l("y"),W.l("z")).rotateSelf(W.l("rx"),W.l("ry"),W.l("rz")).scaleSelf(W.l("w")/2,W.l("h")/2,W.l("d")/2).multiplySelf(e),i:(e,t)=>{e.n||="o"+W.o++,e.b&&e.b.id&&!W.textures[e.b.id]&&(t=gl.createTexture(),gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,!0),gl.bindTexture(gl.TEXTURE_2D,t),gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,1),gl.texImage2D(gl.TEXTURE_2D,0,gl.RGBA,gl.RGBA,gl.UNSIGNED_BYTE,e.b),gl.generateMipmap(gl.TEXTURE_2D),W.textures[e.b.id]=t),e={...W.p[e.n]=W.n[e.n]||{w:1,h:1,d:1,x:0,y:0,z:0,rx:0,ry:0,rz:0,b:"777"},...e},e.t||=0,e.f=0,W.n[e.n]=e},group:e=>{e.T="g",W.i(e)},plane:e=>{e.T="q",W.i(e)},billboard:e=>{e.T="b",W.i(e)},cube:e=>{e.T="c",W.i(e)},pyramid:e=>{e.T="p",W.i(e)},move:e=>W.i(e),camera:e=>{e.n="C",W.i(e)},light:e=>{e.n="L",W.i(e)},d:(e,t,r,l,o,n,i,g=[])=>{for(o in W.dt=(e-W.last)/1e3,W.last=e,requestAnimationFrame(W.d),gl.clear(16640),t=new DOMMatrix([1/Math.tan(.5)/(a.width/a.height),0,0,0,0,1/Math.tan(.5),0,0,0,0,901/-899,-1,0,0,1800/-899,0]),r=new DOMMatrix,W.N="C",r=W.t(r),gl.uniformMatrix4fv(gl.getUniformLocation(W.P,"eye"),!1,r.toFloat32Array()),r.invertSelf(),r.preMultiplySelf(t),gl.uniformMatrix4fv(gl.getUniformLocation(W.P,"pv"),!1,r.toFloat32Array()),W.n)W.n[o].b.id||W.n[o].b[3]?g.push(W.n[o]):W.r(W.n[o]);for(o in g.sort(((e,t)=>e.m&&t.m&&W.dist(t.m,W.n.C.m)-W.dist(e.m,W.n.C.m))),gl.enable(gl.BLEND),g)W.r(g[o]);gl.disable(gl.BLEND)},r:(e,t=[0,0,0],r,l)=>{e.b.id&&(gl.activeTexture(gl.TEXTURE0),gl.bindTexture(gl.TEXTURE_2D,W.textures[e.b.id]),gl.uniform1i(gl.getUniformLocation(W.P,"sampler"),0)),e.f<e.t&&(e.f+=W.dt),e.f>e.t&&(e.f=e.t),"q"==e.T||"b"==e.T?(r=[1,1,0,-1,1,0,-1,-1,0,1,1,0,-1,-1,0,1,-1,0],l=[1,0,0,0,0,1,1,0,0,1,1,1]):"c"==e.T?(r=[1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1,1,1,1,1,-1,-1,1,1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,-1,-1,1,1,-1,1,1,-1,1,-1,-1,-1,-1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,1,1,-1,1,1,-1,-1,-1,-1,1,1,-1,-1,-1,-1,-1,1,-1,-1,-1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,1,1,-1],l=[1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0,1,1,0,1,0,0,1,1,0,0,1,0]):"p"==e.T?(r=[-1,-1,1,1,-1,1,0,1,0,1,-1,1,1,-1,-1,0,1,0,1,-1,-1,-1,-1,-1,0,1,0,-1,-1,-1,-1,-1,1,0,1,0,-1,-1,1,-1,-1,-1,1,-1,1,-1,-1,-1,1,-1,-1,1,-1,1],l=[0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,0,0,1,0,.5,1,1,0,0,0,0,1,1,0,0,1,1,1]):(r=[],l=[]),e.vertices=r,e.texCoords=l,e.center=t,gl.bindBuffer(34962,gl.createBuffer()),gl.bufferData(34962,new Float32Array(r),35044),gl.vertexAttribPointer(buffer=gl.getAttribLocation(W.P,"position"),3,5126,!1,0,0),gl.enableVertexAttribArray(buffer),gl.bindBuffer(34962,gl.createBuffer()),gl.bufferData(34962,new Float32Array(l),35044),gl.vertexAttribPointer(buffer=gl.getAttribLocation(W.P,"tex"),2,5126,!1,0,0),gl.enableVertexAttribArray(buffer),gl.vertexAttrib4fv(gl.getAttribLocation(W.P,"color"),e.b.id?[0,0,0,0]:[...[...e.b].map((e=>("0x"+e)/16)),e.b.id?0:1]),W.N=e.n;var o=new DOMMatrix(W?.n[e.g]?.m);o=W.t(o),W.n[e.n].m=o,gl.uniformMatrix4fv(gl.getUniformLocation(W.P,"m"),!1,o.toFloat32Array()),W.N="L",gl.uniform3f(gl.getUniformLocation(W.P,"light"),W.l("x"),W.l("y"),W.l("z")),gl.uniform3f(gl.getUniformLocation(W.P,"billboard"),e.w,e.h,"b"==e.T),gl.drawArrays(4,0,r.length/3)},dist:(e,t)=>(t.m41-e.m41)**2+(t.m42-e.m42)**2+(t.m43-e.m43)**2},W.s(),W.light({z:1}),W.camera({}),W.d()